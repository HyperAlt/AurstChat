<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AurstChat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Nunito', sans-serif;
      background: linear-gradient(to bottom, #e3f2fd, #ffffff);
      color: #333;
    }
    .container {
      max-width: 420px;
      margin: auto;
      padding: 20px;
    }
    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 20px;
      margin-top: 40px;
    }
    h2 {
      text-align: center;
      color: #1976d2;
    }
    input, select {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    button {
      background: #1976d2;
      color: white;
      padding: 12px;
      width: 100%;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }
    #chat, #chatArea, #dockSelect, #messageInput, #sendBtn, #logoutBtn {
      display: none;
    }
    .message {
      padding: 10px;
      margin: 5px 0;
      border-radius: 8px;
    }
    .you {
      background: #bbdefb;
      text-align: right;
    }
    .them {
      background: #e1f5fe;
    }
  </style>
</head>
<body>

<div class="container">
  <!-- Login Page -->
  <div class="card" id="loginCard">
    <h2>Welcome to AurstChat</h2>
    <input type="text" id="username" placeholder="Username" />
    <input type="password" id="password" placeholder="Password" />
    <label><input type="checkbox" id="rememberMe"> Remember me</label>
    <button onclick="login()">Login</button>
  </div>

  <!-- Chat Page -->
  <div class="card" id="chat">
    <h2 id="welcome"></h2>
    <select id="dockSelect" onchange="switchDock(this.value)">
      <option>Hangouts (Text)</option>
      <option>Hangouts (Voice)</option>
    </select>
    <input type="text" id="newDockName" placeholder="New dock name">
    <select id="dockType">
      <option value="text">Text</option>
      <option value="voice">Voice</option>
    </select>
    <button onclick="createDock()">+ Create Dock</button>

    <div id="chatArea" style="height: 300px; overflow-y: auto; margin-top: 10px; border: 1px solid #ddd; padding: 10px; border-radius: 8px;"></div>
    <input type="text" id="messageInput" placeholder="Type a message..." />
    <button id="sendBtn" onclick="sendMessage()">Send</button>
    <button id="logoutBtn" onclick="logout()">Logout</button>
  </div>
</div>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBVkHxmqq4pyQm3_4ZvxLkVJmZZYj4og5g",
    authDomain: "aurstchat.firebaseapp.com",
    databaseURL: "https://aurstchat-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "aurstchat",
    storageBucket: "aurstchat.appspot.com",
    messagingSenderId: "749704727616",
    appId: "1:749704727616:web:ab31f980b5b195dbbf23a5",
    measurementId: "G-Y35FL4S5FV"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let currentUser = '';
  let currentDock = 'Hangouts (Text)';

  // Check saved login
  window.onload = () => {
    Notification.requestPermission();
    const saved = localStorage.getItem("aurst_user");
    if (saved) {
      const [user, pass] = saved.split(":");
      document.getElementById("username").value = user;
      document.getElementById("password").value = pass;
      login();
    }
  }

  function login() {
    const u = document.getElementById("username").value;
    const p = document.getElementById("password").value;
    if (!u || !p) return alert("Fill both fields");
    currentUser = u;
    if (document.getElementById("rememberMe").checked)
      localStorage.setItem("aurst_user", `${u}:${p}`);
    document.getElementById("loginCard").style.display = "none";
    document.getElementById("chat").style.display = "block";
    document.getElementById("dockSelect").style.display = "block";
    document.getElementById("chatArea").style.display = "block";
    document.getElementById("messageInput").style.display = "block";
    document.getElementById("sendBtn").style.display = "inline-block";
    document.getElementById("logoutBtn").style.display = "inline-block";
    document.getElementById("welcome").innerText = `Hi ${u}!`;
    loadMessages(currentDock);
  }

  function logout() {
    localStorage.removeItem("aurst_user");
    location.reload();
  }

  function createDock() {
    const name = document.getElementById("newDockName").value;
    const type = document.getElementById("dockType").value;
    if (!name) return;
    const dock = `${name} (${type === 'voice' ? 'Voice' : 'Text'})`;
    const opt = document.createElement("option");
    opt.text = dock;
    document.getElementById("dockSelect").add(opt);
    document.getElementById("dockSelect").value = dock;
    switchDock(dock);
  }

  function switchDock(dockName) {
    currentDock = dockName;
    loadMessages(dockName);
  }

  function loadMessages(dockName) {
    const chatArea = document.getElementById("chatArea");
    chatArea.innerHTML = '';
    db.ref("chat/" + dockName).off(); // remove previous listener
    db.ref("chat/" + dockName).on("child_added", snapshot => {
      const msg = snapshot.val();
      const div = document.createElement("div");
      div.className = "message " + (msg.user === currentUser ? "you" : "them");
      div.innerText = msg.user + ": " + msg.text;
      chatArea.appendChild(div);
      chatArea.scrollTop = chatArea.scrollHeight;

      if (msg.user !== currentUser) {
        new Notification("New Message", {
          body: msg.user + ": " + msg.text
        });
      }
    });
  }

  function sendMessage() {
    const msg = document.getElementById("messageInput").value;
    if (!msg) return;
    db.ref("chat/" + currentDock).push({
      user: currentUser,
      text: msg
    });
    document.getElementById("messageInput").value = "";
  }
</script>
</body>
</html>